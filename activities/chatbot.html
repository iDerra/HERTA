<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HERTA - Chatbot</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
        
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/chatbot/chatbot_layout.css">
    <link rel="stylesheet" href="../css/chatbot/chatbot_sim.css">
    <link rel="stylesheet" href="../css/chatbot/chatbot_train.css">
</head>
<body>

    <header>
        <div style="justify-content: space-between; align-items: center;">
            <h1>Simulador Chatbot</h1>
        </div>
        <div style="margin-top: 10px;">
            <button onclick="location.href='../index.html'" style="background: rgba(0,0,0,0.3); font-size: 0.9rem;">
                â¬… Volver al MenÃº
            </button>
            <button onclick="resetActivity()" 
                    style="background: #e74c3c; font-size: 0.8rem; border-bottom-color: #c0392b;">
                ğŸ—‘ï¸ Reiniciar Actividad
            </button>
        </div>
    </header>

    <nav class="tabs-container">
        <button class="tab-btn active" data-target="tab-config" onclick="switchTab('tab-config')">1. ConfiguraciÃ³n</button>
        <button class="tab-btn" id="btn-train" data-target="tab-train" onclick="switchTab('tab-train')" disabled>2. Entrenamiento ğŸ”’</button>
        <button class="tab-btn" id="btn-chat" data-target="tab-chat" onclick="switchTab('tab-chat')" disabled>3. SimulaciÃ³n ğŸ”’</button>
    </nav>

    <main>
        <section id="tab-config" class="tab-content active">
            <h2>ğŸ¢ Crea tu Negocio</h2>
            <div id="status-panel" class="status-box"></div> <div style="margin: 20px 0;">
                <label>Nombre de la tienda:</label>
                <input type="text" id="shop-name-input" placeholder="Ej: Tienda IA" oninput="updateShopName()">
            </div>
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
            
            <h3>ğŸ“¦ Inventario (Base de Datos)</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="text" id="prod-name" placeholder="Producto (Sustantivo)" style="flex: 2;">
                <input type="number" id="prod-price" placeholder="Precio (â‚¬)" style="flex: 1;">
                <input type="text" id="prod-feature" placeholder="CaracterÃ­stica (Adjetivo)" style="flex: 2;">
            </div>
            <button onclick="addProduct()" style="width: 100%; margin-top: 10px;">+ AÃ±adir a la Base de Datos</button>
            <div id="products-list-ui" style="margin-top: 20px;"></div>
        </section>

        <section id="tab-train" class="tab-content">
            
            <div id="training-classification-ui" style="display: none;">
                <h2>ğŸ” Paso 1: ClasificaciÃ³n Gramatical</h2>
                <p>Para que la IA hable bien, necesita saber el gÃ©nero y nÃºmero de tus productos.</p>
                
                <div class="classification-container">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: #f4f4f8; color: #666;">
                                <th style="padding: 10px; text-align: left;">Producto</th>
                                <th style="padding: 10px;">GÃ©nero</th>
                                <th style="padding: 10px;">NÃºmero</th>
                            </tr>
                        </thead>
                        <tbody id="classification-list">
                            </tbody>
                    </table>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="saveClassificationAndStart()" style="background: var(--herta-main); width: 250px;">
                        ğŸ’¾ Guardar y Empezar Entrenamiento
                    </button>
                </div>
            </div>

            <div id="training-game-wrapper" style="display: none;">
                <h2>ğŸ§  Paso 2: Entrenamiento SintÃ¡ctico</h2>
                <p>Analiza <strong>todas</strong> las palabras de la oraciÃ³n.</p>
                
                <div id="training-complete-msg" style="display: none; text-align: center; padding: 40px; background: #e8f8f5; border-radius: 12px;">
                    <h3 style="color: #27ae60; font-size: 2rem; margin-bottom: 10px;">ğŸ‰ Â¡SesiÃ³n Finalizada!</h3>
                    <p>Has analizado correctamente 5 frases.</p>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px;">
                        <button onclick="startTrainingRound()" style="background: #34495e;">ğŸ”„ Analizar otras 5 frases</button>
                        <button onclick="switchTab('tab-chat')" style="background: var(--herta-main);">ğŸ’¬ Ir a la SimulaciÃ³n</button>
                    </div>
                </div>

                <div id="training-game-ui">
                    <div class="progress-bar-container">
                        <div id="train-progress-fill" style="width: 0%; height: 100%; background: var(--herta-main); transition: width 0.3s;"></div>
                    </div>
                    <p style="text-align: center; margin-bottom: 15px; color: #666;">Frase <span id="current-sentence-num">1</span> de 5</p>

                    <div class="tools-grid">
                        <button class="tool-btn tool-noun selected" onclick="selectTool('noun')">ğŸŸ£ Sustantivo (Producto)</button>
                        <button class="tool-btn tool-adj" onclick="selectTool('adj')">ğŸŸ¡ Adjetivo (CaracterÃ­stica)</button>
                        <button class="tool-btn tool-verb" onclick="selectTool('verb')">ğŸ”µ Verbo</button>
                        <button class="tool-btn tool-det" onclick="selectTool('det')">ğŸŸ¢ Determinante</button>
                        <button class="tool-btn tool-other" onclick="selectTool('other')">âšª Otros</button>
                    </div>

                    <div class="training-area">
                        <div id="sentence-container" class="sentence-display"></div>
                        <div id="feedback-msg" style="min-height: 25px; font-weight: bold; margin-top: 15px;"></div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="validateSentence()" style="width: 200px;">Validar AnÃ¡lisis</button>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="tab-chat" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 20px;">ğŸ’¬ SimulaciÃ³n en Vivo</h2>
            
            <div class="chat-container" style="position: relative;"> <div id="cart-indicator" class="cart-indicator" onclick="simulateUserClick('ver cesta')">
                    ğŸ›’ <span id="cart-count">0</span>
                </div>

                <div id="chat-history-container" class="chat-history"></div>
                
                <div id="typing-indicator" class="typing-indicator">Escribiendo...</div>

                <div class="chat-input-area">
                    <input type="text" id="sim-user-input" placeholder="Ej: Hola, quiero aÃ±adir unas zapatillas...">
                    <button onclick="handleUserMessage()" style="border-radius: 50%; width: 50px; height: 50px; padding: 0; display: flex; align-items: center; justify-content: center;">â¤</button>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="location.reload()" style="background: #95a5a6; font-size: 0.8rem;">Reiniciar Chat</button>
            </div>
        </section>
    </main>

    <script src="../js/chatbot/chatbot_core.js"></script>
    <script src="../js/chatbot/chatbot_setup.js"></script>
    <script src="../js/chatbot/chatbot_sim.js"></script>
    <script src="../js/chatbot/chatbot_train.js"></script>

    <script>
        const originalSwitchTab = window.switchTab;
        window.switchTab = function(tabId) {
            originalSwitchTab(tabId); 
            
            if (tabId === 'tab-chat') {
                setTimeout(() => {
                    if(typeof initChatGreeting === 'function') initChatGreeting();
                }, 100);
            }
        }
    </script>
</body>
</html>